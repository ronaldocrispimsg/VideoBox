# Setup da instância PROCESS

## 1. Requisitos do sistema
sudo apt update && sudo apt upgrade -y
sudo apt install -y ca-certificates curl gnupg lsb-release nfs-common ffmpeg

## 2. Docker + Compose
curl -fsSL https://get.docker.com | sh
sudo usermod -aG docker ubuntu
sudo systemctl enable docker && sudo systemctl start docker

## 3. Montar storage compartilhado (EFS/NFS)
# Exemplo usando NFS: substitua pelo DNS do EFS
sudo mkdir -p /srv/videobox/export
sudo tee /etc/fstab <<'EOF'
<EFS_DNS>:/    /srv/videobox/export   nfs4    defaults,_netdev  0  0
EOF
sudo mount -a
sudo chown -R ubuntu:ubuntu /srv/videobox/export

## 4. Variáveis de ambiente para o container
cat <<'EOF' > /etc/default/process.env
RABBIT_URL=amqp://videobox:123456@10.x.x.x/
EXPORT_PATH=/srv/videobox/export
CLEAN_TMP=true
EOF

## 5. Executar o container
docker run -d \
  --name videobox-process \
  --restart unless-stopped \
  --network host \
  --env-file /etc/default/process.env \
  -v /srv/videobox/export:/srv/videobox/export \
  videobox-process:latest

## 6. Registrar no k3s (opcional)
# Caso o node participe do cluster, use o script em infra/k3s.md.
